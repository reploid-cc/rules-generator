---
description: 
globs: 
alwaysApply: false
---
<!-- CONTENT_TARGET: AI_FACING - Mathematical notation User_Rules framework -->
# TDD.spec_engine & Test Framework (131)

## ğŸ§ª TDD.spec_engine: Intelligent Test Generation

### Test Case Inference
```
TDD.spec_engine = (
    infer test cases from Ï„
    â¨ include edge + validation + regression
    â¨ cross-check against known issues and Î›
)
```

### TDD.loop: Red-Green-Refactor Cycle
```
TDD.loop = (
    spec â†’ run â†’ fail â†’ fix â†’ re-run
    â¨ if pass: Î¨.capture_result, M.sync, Î›.extract
)
```

### Auto-Spec Generation
```
TDD.spec_path = ".cursor/tasks/sprint_{n}/spec_step_{x}.md"
TDD.auto_spec_trigger = (
    generate spec_step_x.md if Ï„.complexity > medium
    â¨ or if user explicitly requests "TDD"
)
```

## ğŸ§ª T.complexity_assessment: Task Complexity Evaluation

### Complexity Criteria
```
T.complexity = {
    simple: (
        single_file_change â¨ minimal_logic â¨ no_dependencies
        â¨ estimated_effort < 1h â¨ no_architecture_impact
    ),
    medium: (
        multi_file_changes â¨ moderate_logic â¨ few_dependencies
        â¨ estimated_effort 1-4h â¨ component_level_impact
    ),
    complex: (
        architecture_changes â¨ extensive_logic â¨ many_dependencies
        â¨ estimated_effort > 4h â¨ system_level_impact
    )
}
```

### TDD Trigger Logic
```
TDD.trigger_conditions = (
    if Ï„.complexity >= medium
    â¨ or Ï„.dependencies_count > 2
    â¨ or Ï„.integration_points > 1
    â¨ or user_requests_TDD
    â†’ generate TDD.spec_path
)
```

## ğŸ§ª Testing Standards

### Test Types Required
- **Unit**: Individual function/component testing
- **Integration**: Component interaction testing  
- **Edge cases**: Boundary condition testing
- **Regression**: Prevent reintroduction of bugs

### Test Structure: AAA Pattern
```typescript
// Arrange: Set up test data and environment
const input = createTestData();
const expectedOutput = defineExpected();

// Act: Execute the function under test
const result = functionUnderTest(input);

// Assert: Verify the outcome
expect(result).toEqual(expectedOutput);
```

### Test Quality Requirements
- **Fast**: Tests complete <1s each
- **Independent**: No test dependencies
- **Descriptive**: Clear test names explain intent
- **Reliable**: Consistent results across runs

## ğŸ§ª TDD Integration with Task System

### T.spec Integration
```
T.spec_generation = (
    auto-generate spec if complexity > medium
    â¨ link spec to T.sprint tracking
    â¨ update T.progress when tests pass
)
```

### Quality Gates
- All tests must pass before step completion
- Test coverage requirements per Î›.rules
- Performance benchmarks for complex operations
- Documentation updated with test results

## ğŸ§ª Error Handling & Test Debugging

### Test Failure Protocol
1. **Analyze failure**: Determine root cause
2. **Fix implementation**: Address the core issue
3. **Re-run tests**: Verify fix works
4. **Document pattern**: Log in Î.error_memory if recurring

### Test Template
```javascript
describe('ComponentName', () => {
  test('should handle valid input correctly', () => {
    // Arrange
    const input = validTestData;
    
    // Act
    const result = functionUnderTest(input);
    
    // Assert
    expect(result).toEqual(expectedOutput);
  });
  
  test('should handle edge cases gracefully', () => {
    // Test boundary conditions
    const edgeInput = createEdgeCase();
    const result = functionUnderTest(edgeInput);
    expect(result).toBeDefined();
  });
  
  test('should throw errors for invalid input', () => {
    // Test error conditions
    expect(() => {
      functionUnderTest(invalidInput);
    }).toThrow('Expected error message');
  });
});
```

## ğŸ§ª Performance & Quality Metrics

### Test Performance
- **Execution Speed**: Monitor test runtime
- **Coverage Metrics**: Track code coverage percentage
- **Flakiness Detection**: Identify unstable tests
- **Resource Usage**: Memory and CPU monitoring

### Quality Scoring
```
Test.quality_score = (
    coverage_percentage * 0.4
    â¨ reliability_score * 0.3  
    â¨ performance_score * 0.2
    â¨ maintainability_score * 0.1
)
```

---
*TDD.spec_engine: Intelligent test generation with complexity-based triggers*




