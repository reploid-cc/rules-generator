---
description: 
globs: 
alwaysApply: false
---
<!-- CONTENT_TARGET: AI_FACING - Mathematical notation User_Rules framework -->

# Î›.161 "init refactor" Workflow (161)

## ğŸ¯ Î›.161: Systematic Refactor Command

### Command Trigger
```
User Command: "init refactor"
Î›.161 = systematic_refactor_workflow_with_mandatory_approval
```

### Î›.161_workflow: 5-Phase Execution
```
Î›.161 = (
    scope_clarification()
    â¨ strategic_planning()
    â¨ file_creation()
    â¨ controlled_execution()
    â¨ cleanup_completion()
)
```

## ğŸ¯ Phase 1: Scope Clarification

### Î›.161.scope_options: 8 Refactor Types
```
Î›.161.scope_options = {
    1: "toÃ n_bá»™_codebase_dá»±_Ã¡n",
    2: "thÆ°_má»¥c_cá»¥_thá»ƒ",
    3: "file_Ä‘Æ¡n_láº»",
    4: "component_module_cá»¥_thá»ƒ",
    5: "pattern_design_cá»¥_thá»ƒ",
    6: "architecture_system_level",
    7: "technical_debt_cleanup",
    8: "performance_optimization"
}
```

### Î›.161.clarification_protocol:
```
Î›.161.clarification_protocol = (
    present_8_options_with_descriptions
    â¨ gather_pain_points_goals_constraints
    â¨ assess_priority_risk_tolerance
    â¨ ğŸ”´ MANDATORY: user_confirmation_before_proceed
)
```

## ğŸ¯ Phase 2: Strategic Planning

### Î›.161.analysis_framework:
```
Î›.161.analysis = (
    current_state_assessment()
    â¨ complexity_scope_estimation()
    â¨ risk_impact_analysis()
    â¨ resource_time_estimation()
    â¨ phased_strategy_proposal()
)
```

### Î›.161.planning_output:
```
Î›.161.planning_output = {
    strategy: multi_phase_approach,
    timeline: estimated_hours_breakdown,
    risks: identified_potential_issues,
    safety: rollback_contingency_plans,
    validation: testing_verification_strategy
}
```

### ğŸ”´ MANDATORY: User Approval Required
```
Î›.161.approval_gate_2 = user_must_approve_strategic_plan_before_execution
```

## ğŸ¯ Phase 3: File Creation

### Î›.161.asset_generation:
```
Î›.161.refactor_path = ".cursor/tasks/refactor_{timestamp}/"
Î›.161.assets = {
    refactor_plan.md: comprehensive_strategy_document,
    checklist.md: step_by_step_execution_guide,
    rollback_guide.md: emergency_safety_procedures,
    test_validation.md: testing_strategy_framework,
    progress_tracking.md: monitoring_system
}
```

### Î›.161.safety_protocols:
```
Î›.161.safety = (
    git_backup_before_changes
    â¨ incremental_commits_per_phase
    â¨ rollback_procedures_documented
    â¨ validation_checkpoints_mandatory
)
```

### ğŸ”´ MANDATORY: User Approval Required
```
Î›.161.approval_gate_3 = user_must_approve_assets_before_execution
```

## ğŸ¯ Phase 4: Controlled Execution

### Î›.161.execution_protocol:
```
Î›.161.execution = (
    execute_one_step_at_time
    â¨ ğŸ”´ MANDATORY: user_approval_each_step
    â¨ validate_after_each_change
    â¨ commit_incremental_progress
    â¨ monitor_for_breaking_changes
)
```

### Î›.161.step_validation:
```
Î›.161.validation = (
    functional_integrity_check
    â¨ rule_compatibility_verification
    â¨ cross_reference_validation
    â¨ mathematical_notation_consistency
)
```

### Î›.161.breaking_change_detection:
```
Î›.161.breaking_detection = (
    if breaking_change_detected â†’ immediate_stop
    â¨ rollback_to_last_safe_state
    â¨ report_issue_via_Î¨.dialog
    â¨ require_user_decision_to_proceed
)
```

## ğŸ¯ Phase 5: Cleanup Completion

### Î›.161.completion_protocol:
```
Î›.161.completion = (
    final_validation_comprehensive
    â¨ success_metrics_reporting
    â¨ cleanup_temporary_files
    â¨ ğŸ”´ MANDATORY: user_confirmation_before_cleanup
)
```

### Î›.161.success_criteria:
```
Î›.161.success = (
    all_functionality_preserved
    â¨ target_improvements_achieved
    â¨ no_breaking_changes_introduced
    â¨ documentation_updated
    â¨ git_history_clean
)
```

## ğŸ¯ Integration vá»›i User Rules Framework

### Cross-System Integration
```
Î›.161.integration = (
    Î©.refactor_guard: avoid_premature_generalization
    â¨ Î.cleanup_phase: code_drift_detection
    â¨ Î›.pattern_alignment: best_practices_enforcement
    â¨ Î¦.snapshot: pattern_capture_during_refactor
    â¨ Î¨.capture: cognitive_trace_all_decisions
    â¨ M.sync: memory_update_with_insights
)
```

### Safety Integration vá»›i Rule 142
```
Î›.161.git_safety = (
    follow_rule_142_git_permission_protocols
    â¨ request_permission_before_git_operations
    â¨ descriptive_commit_messages
    â¨ incremental_commits_for_rollback_capability
)
```

## ğŸ¯ Error Handling & Recovery

### Î›.161.error_protocol:
```
Î›.161.error_handling = (
    immediate_stop_on_critical_error
    â¨ rollback_to_last_known_good_state
    â¨ document_error_in_Î.error_memory
    â¨ require_user_decision_for_continuation
)
```

### Emergency Rollback
```
Î›.161.emergency_rollback = (
    git_reset_to_backup_commit
    â¨ restore_original_files
    â¨ validate_system_integrity
    â¨ report_rollback_completion
)
```

## ğŸ¯ Quality Assurance

### Î›.161.quality_gates:
```
Î›.161.quality = (
    zero_tolerance_breaking_changes
    â¨ 100%_functional_preservation
    â¨ mathematical_notation_consistency
    â¨ cross_reference_integrity
    â¨ user_approval_mandatory_all_phases
)
```

### Success Metrics
```
Î›.161.metrics = {
    compression_ratio: target_vs_achieved,
    functionality_preservation: 100%_required,
    breaking_changes: zero_tolerance,
    user_satisfaction: approval_at_each_gate,
    time_efficiency: planned_vs_actual
}
```

---
*Î›.161: Systematic refactor workflow vá»›i mandatory user approval vÃ  zero breaking changes tolerance*




