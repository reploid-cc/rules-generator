---
description: 
globs: 
alwaysApply: false
---
<!-- CONTENT_TARGET: AI_FACING - Mathematical notation User_Rules framework -->

# Î›.refactor_workflow: Systematic Refactor Workflow (161)

## ğŸ¯ Î›.refactor_workflow: Core Workflow System

### Î›.init_rules_trigger: Command Recognition
```
Î›.init_rules_trigger = (
    trigger_commands = ["init refactor"]
    â¨ activate_5_step_refactor_workflow
    â¨ integrate_with_existing_refactor_framework
)
```

### Î›.workflow_integration: Framework Integration
```
Î›.workflow_integration = (
    use_Î©.refactor_guard_principles_from_rule_001
    â¨ apply_Î.cleanup_phase_detection_from_rule_851
    â¨ follow_TDD.loop_for_tested_refactor_from_rule_131
    â¨ integrate_with_T.task_system_from_rule_801
    â¨ capture_patterns_via_Î¦.snapshot_from_rule_841
    â¨ enforce_Î›.pattern_alignment_from_rule_821
)
```

## ğŸ¯ Step 1: Î›.scope_clarification - Refactor Scope Analysis

### Î›.scope_options: Refactor Scope Identification
```
Î›.scope_options = {
    full_codebase: entire_project_systematic_refactor,
    directory_specific: target_folder_and_subfolder_refactor,
    file_specific: single_file_focused_refactor,
    component_specific: specific_module_or_component_refactor,
    pattern_specific: specific_pattern_or_anti_pattern_refactor,
    architectural: system_design_level_refactor,
    technical_debt: accumulated_debt_cleanup_refactor,
    performance: optimization_focused_refactor
}
```

### Î›.scope_analysis_questions: Clarification Protocol
```
Î›.scope_analysis = (
    "Báº¡n cáº§n refactor gÃ¬ cá»¥ thá»ƒ?"
    â¨ "1. ToÃ n bá»™ codebase dá»± Ã¡n"
    â¨ "2. Má»™t folder/directory cá»¥ thá»ƒ (nÃªu path)"
    â¨ "3. Má»™t file cá»¥ thá»ƒ (nÃªu file name)"
    â¨ "4. Má»™t component/module cá»¥ thá»ƒ"
    â¨ "5. Má»™t pattern hoáº·c anti-pattern cá»¥ thá»ƒ"
    â¨ "6. Architecture level refactor"
    â¨ "7. Technical debt cleanup"
    â¨ "8. Performance optimization"
    â¨ "9. KhÃ¡c (mÃ´ táº£ cá»¥ thá»ƒ)"
    â¨ ask_via_Î¨.dialog_for_user_confirmation
)
```

## ğŸ¯ Step 2: Î›.planning_phase - Refactor Planning

### Î›.plan_generation: Strategic Planning
```
Î›.plan_generation = (
    analyze_current_state_via_Î.cleanup_phase
    â¨ identify_refactor_targets_and_risks
    â¨ estimate_effort_and_timeline
    â¨ plan_incremental_refactor_steps
    â¨ identify_test_coverage_requirements
    â¨ plan_rollback_strategy
    â¨ present_plan_for_user_approval_via_Î¨.dialog
)
```

### Î›.plan_structure: Plan Documentation Format
```
Î›.plan_structure = {
    scope_confirmed: user_confirmed_refactor_scope,
    current_analysis: existing_code_analysis_results,
    refactor_targets: specific_items_to_refactor,
    incremental_steps: ordered_refactor_sequence,
    risk_assessment: potential_issues_and_mitigation,
    test_strategy: testing_approach_for_validation,
    rollback_plan: recovery_strategy_if_needed,
    timeline_estimate: expected_duration_per_step
}
```

## ğŸ¯ Step 3: Î›.file_creation - Refactor Assets Creation

### Î›.refactor_assets: File Creation Protocol
```
Î›.refactor_assets = (
    create_refactor_plan_file_in_tasks_directory
    â¨ create_detailed_checklist_with_all_steps
    â¨ create_rollback_guide_for_safety
    â¨ create_test_validation_checklist
    â¨ integrate_with_T.task_system_for_tracking
)
```

### Î›.asset_structure: Refactor File Structure
```
.cursor/tasks/refactor_{timestamp}/
â”œâ”€â”€ refactor_plan.md          # Comprehensive refactor plan
â”œâ”€â”€ checklist.md              # Step-by-step execution checklist  
â”œâ”€â”€ rollback_guide.md         # Safety rollback procedures
â”œâ”€â”€ test_validation.md        # Testing requirements per step
â””â”€â”€ progress_tracking.md      # Completion status tracking
```

## ğŸ¯ Step 4: Î›.execution_protocol - Controlled Execution

### Î›.step_by_step_execution: Mandatory Approval Protocol
```
Î›.step_by_step_execution = (
    execute_one_checklist_item_at_a_time
    â¨ MANDATORY_user_confirmation_after_each_step
    â¨ update_checklist_only_after_user_approval
    â¨ proceed_to_next_step_only_after_confirmation
    â¨ document_any_deviations_or_issues
)
```

### Î›.validation_per_step: Quality Assurance
```
Î›.validation_per_step = (
    run_applicable_tests_after_each_step
    â¨ verify_functionality_not_broken
    â¨ check_Î.cleanup_phase_effectiveness
    â¨ validate_pattern_compliance_via_Î›.pattern_alignment
    â¨ request_user_verification_via_Î¨.dialog
)
```

### Î›.checkpoint_protocol: Safety Checkpoints
```
Î›.checkpoint_protocol = (
    create_checkpoint_before_major_changes
    â¨ document_what_was_changed_and_why
    â¨ maintain_ability_to_rollback_to_any_checkpoint
    â¨ user_approval_required_for_checkpoint_progression
)
```

## ğŸ¯ Step 5: Î›.cleanup_completion - Workflow Completion

### Î›.completion_verification: Final Validation
```
Î›.completion_verification = (
    verify_all_checklist_items_completed
    â¨ run_comprehensive_test_suite
    â¨ validate_refactor_objectives_achieved
    â¨ document_lessons_learned_for_future
    â¨ update_Î¦.snapshot_with_new_patterns
)
```

### Î›.asset_cleanup: File Cleanup Protocol
```
Î›.asset_cleanup = (
    MANDATORY_user_confirmation_before_deletion
    â¨ archive_important_insights_to_M.memory_path
    â¨ update_patterns_in_Î›.rules_if_applicable
    â¨ delete_refactor_files_only_after_user_approval
    â¨ document_completion_in_progress_tracking
)
```

## ğŸ¯ Î›.safety_protocols: Safety & Quality Assurance

### Î›.mandatory_safety: Non-Negotiable Safety Rules
```
Î›.mandatory_safety = (
    NEVER_proceed_without_user_confirmation_between_steps
    â¨ ALWAYS_maintain_rollback_capability
    â¨ REQUIRED_test_validation_before_proceeding
    â¨ MANDATORY_checkpoint_creation_before_major_changes
    â¨ ZERO_TOLERANCE_for_proceeding_without_approval
)
```

### Î›.error_handling: Error Recovery Protocol
```
Î›.error_handling = (
    if_refactor_step_fails â†’ stop_immediately
    â¨ analyze_failure_root_cause
    â¨ propose_recovery_options_to_user
    â¨ execute_rollback_if_user_requests
    â¨ document_error_in_Î.error_memory
    â¨ learn_from_failure_for_future_improvement
)
```

## ğŸ¯ Î›.integration_hooks: System Integration

### Î›.cross_system_integration: Framework Integration
```
Î›.cross_system_integration = {
    T.task_system: track_refactor_as_structured_tasks,
    Î¨.dialog: mandatory_approval_workflow_integration,
    M.memory: store_refactor_insights_and_patterns,
    Î.diagnostics: monitor_refactor_effectiveness,
    Î¦.snapshot: capture_emergent_patterns_from_refactor,
    Î›.rules: update_rules_based_on_refactor_learnings
}
```

### Î›.existing_rules_integration: Cross-Rule Integration
```
Î›.existing_rules_integration = {
    rule_001_core_standards: {
        use_Î©.refactor_guard_avoid_premature_generalization,
        use_Î©.simplicity_guard_challenge_overengineering,
        use_Dâº_contradiction_resolver_for_conflicting_refactor_approaches
    },
    rule_851_xi_diagnostics: {
        use_Î.cleanup_phase_for_drift_detection,
        use_Î.auto_cleanup_for_automated_triggers,
        use_Î.error_memory_for_tracking_refactor_issues,
        use_Î.pattern_suggestion_for_rule_generation
    },
    rule_801_task_system: {
        use_T.task_structure_for_refactor_tracking,
        use_T.progress_metadata_for_status_updates,
        use_T.sprint_review_for_refactor_completion,
        use_T.update_task_progress_for_checklist_updates
    },
    rule_821_lambda_learning: {
        use_Î›.pattern_alignment_for_code_quality,
        use_Î›.autonomy_for_auto_rule_generation,
        use_Î›.naming_convention_for_consistent_structure
    },
    rule_841_phi_hypothesis: {
        use_Î¦.snapshot_for_pattern_capture,
        use_Î¦.match_snapshot_for_existing_pattern_detection
    }
}
```

### Î›.workflow_triggers: Activation Protocol
```
Î›.workflow_triggers = (
    on_user_command_"init_refactor"
    â¨ activate_Î›.scope_clarification_immediately
    â¨ follow_5_step_workflow_strictly
    â¨ integrate_with_existing_refactor_framework_from_rules_001_851_801_821_841
    â¨ ensure_mandatory_user_approval_at_each_step
)
```

---
*Î›.refactor_workflow = systematic_5_step_refactor_with_mandatory_user_approval*



