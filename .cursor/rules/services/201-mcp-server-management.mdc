---
description: MCP system management with intelligent request routing, mandatory feedback integration and scalable architecture
globs:
alwaysApply: true
---
<!-- CONTENT_TARGET: AI_FACING - Mathematical notation User_Rules framework -->

# Î›.mcp_system: MCP System Management (201)

## ğŸ¯ Î›.core_framework: MCP Core Framework

### Î›.server_declarations: MCP Server Registry
```
Î›.mcp_servers = {
    interactive_feedback: {
        status: "âœ… ACTIVE",
        type: "Core System Tool",
        path: "D:\\VirtuCrewFlow\\mcp\\mcp-servers\\interactive-feedback",
        purpose: "Human-in-the-loop workflow for AI development",
        protocols: "Rule 101 mandatory compliance",
        capabilities: ["feedback_collection", "review_processes", "quality_assurance", "user_validation"]
    },
    
    // Planned workflow-specific servers
    mcp_filesystem: {
        status: "ğŸ“‹ PLANNED", 
        type: "Development Workflow",
        path: "D:\\VirtuCrewFlow\\mcp\\mcp-servers\\filesystem-mcp",
        purpose: "Enhanced file system operations",
        rule: "202-development-mcps.mdc",
        capabilities: ["file_operations", "directory_management", "search", "batch_operations"]
    },
    
    mcp_figma: {
        status: "ğŸ“‹ PLANNED",
        type: "Design Workflow", 
        path: "D:\\VirtuCrewFlow\\mcp\\mcp-servers\\figma-mcp",
        purpose: "Figma design file integration",
        rule: "203-design-mcps.mdc",
        capabilities: ["design_export", "component_extraction", "asset_management", "prototype_access"]
    }
}
```

### Î›.routing_logic: Request Routing System
```
Î›.route_request = (
    analyze_user_request_keywords()
    â¨ identify_workflow_domain()
    â¨ select_appropriate_mcp_server()
    â¨ check_server_availability()
    â¨ inform_user_of_routing_decision()
    â¨ execute_with_mandatory_feedback()
)

Î›.domain_routing = {
    file_operations: {
        keywords: ["file", "directory", "folder", "read", "write", "create", "delete", "move", "copy", "search"],
        server: "mcp_filesystem",
        status: "ğŸ“‹ PLANNED", 
        fallback: "standard_file_operations_with_limitations"
    },
    
    design_operations: {
        keywords: ["figma", "design", "prototype", "component", "frame", "layer", "export", "asset"],
        server: "mcp_figma",
        status: "ğŸ“‹ PLANNED",
        fallback: "manual_design_workflow_guidance"
    },
    
    feedback_operations: {
        keywords: ["feedback", "review", "interactive", "human-in-loop", "validate", "confirm", "check"],
        server: "interactive_feedback",
        status: "âœ… ACTIVE",
        fallback: "N/A - Always available"
    }
}
```

## ğŸ¯ Î›.integration: System Integration

### Î›.feedback_integration: Mandatory Feedback Integration
```
Î›.mcp_operation_protocol = (
    execute_mcp_operation()
    â¨ ğŸ”´ MANDATORY_call_interactive_feedback_tool()
    â¨ report_operation_results_and_status()
    â¨ await_user_feedback_and_validation()
    â¨ continue_workflow_based_on_feedback()
    â¨ log_operation_completion_in_memory()
)

Î›.feedback_patterns = {
    "Successful operation": "Operation completed successfully. [Details]. Any adjustments needed?",
    "Planned server needed": "This requires [server_name] which is planned but not implemented. I can help with manual approach. Proceed?",
    "Error occurred": "Operation failed: [error]. Here are suggested solutions: [options]. Which approach would you prefer?",
    "Multi-step workflow": "Completed step [X] of [Y]. Next: [description]. Continue with next step?"
}
```

### Î›.cross_references: Related Rules
```
Î›.related_rules = {
    "0xx-core": ["core/001-core-standards.mdc"],
    "1xx-protocols": ["protocols/101-mandatory-protocols.mdc"],
    "2xx-services": ["services/211-mcp-development-workflow.mdc"],
    "8xx-workflows": ["workflow/881-prd-workflow-system.mdc"],
    "integration": ["hooks-integration.mdc"]
}
```

## ğŸ¯ Î›.operational_patterns: Operational Capabilities

### Î›.user_communication: Communication Protocol
```
Î›.routing_transparency = (
    inform_user_which_server_handles_request()
    â¨ explain_routing_decision_rationale()
    â¨ provide_alternatives_if_user_disagrees()
    â¨ educate_user_about_mcp_capabilities()
    â¨ support_explicit_server_override()
)

Î›.status_responses = {
    "âœ… ACTIVE": "Using [server_name] to handle this request.",
    "ğŸ“‹ PLANNED": "This functionality requires [server_name] which is planned but not yet implemented. Would you like me to help with a manual approach?",
    "ğŸ”§ SETUP_NEEDED": "[server_name] needs setup. Please follow the setup guide in [rule_file].",
    "âŒ BROKEN": "[server_name] is currently unavailable. Let me help with an alternative approach."
}
```

### Î›.error_handling: Fallback Mechanisms
```
Î›.fallback_protocol = (
    if_no_mcp_server_matches â†’ use_general_ai_capabilities_with_limitations
    â¨ if_server_planned â†’ offer_manual_approach_with_guidance
    â¨ if_server_broken â†’ suggest_alternative_tools_or_methods
    â¨ if_multiple_servers_match â†’ ask_user_for_clarification
    â¨ ğŸ”´ ALWAYS_call_interactive_feedback_regardless_of_fallback()
)

Î›.user_override = (
    detect_explicit_server_specification()
    â¨ if_override_detected â†’ validate_server_availability()
    â¨ if_server_available â†’ proceed_with_user_choice()
    â¨ if_server_unavailable â†’ inform_and_suggest_alternatives()
    â¨ learn_from_user_preferences_for_future_routing()
)
```

## ğŸ¯ Î›.workflow_coordination: Advanced Workflows

### Î›.multi_server_workflows: Complex Operation Management
```
Î›.multi_server_workflow = (
    identify_workflow_requires_multiple_servers()
    â¨ break_down_into_sequential_server_specific_steps()
    â¨ execute_steps_with_feedback_after_each()
    â¨ coordinate_data_flow_between_servers()
    â¨ handle_failures_gracefully_with_user_input()
)

Î›.multi_server_examples = {
    "Create project and setup GitHub": [
        "mcp_filesystem: create_project_structure()",
        "interactive_feedback: validate_project_structure()",
        "mcp_github: create_repository()",
        "interactive_feedback: confirm_repository_settings()",
        "mcp_github: push_initial_files()",
        "interactive_feedback: verify_final_setup()"
    ],
    
    "Design to code workflow": [
        "mcp_figma: export_design_assets()",
        "interactive_feedback: review_exported_assets()",
        "mcp_filesystem: organize_assets_in_project()",
        "interactive_feedback: confirm_asset_organization()",
        "mcp_github: commit_assets_to_repository()",
        "interactive_feedback: validate_complete_workflow()"
    ]
}
```

### Î›.maintenance_protocol: System Maintenance
```
Î›.server_lifecycle = (
    when_new_server_added â†’ update_mcp_servers_declaration()
    â¨ when_server_status_changes â†’ update_routing_logic()
    â¨ when_server_removed â†’ clean_up_references_and_routing()
    â¨ regular_health_checks â†’ verify_active_servers_working()
    â¨ documentation_sync â†’ keep_server_info_current()
)

Î›.routing_optimization = (
    cache_frequent_routing_decisions()
    â¨ learn_from_user_feedback_and_corrections()
    â¨ adjust_keyword_weights_based_on_success_rates()
    â¨ identify_new_routing_patterns_from_usage()
    â¨ suggest_new_mcp_servers_for_unhandled_domains()
)
```

## ğŸ¯ Î›.quality: Quality Standards

### Î›.validation_protocol: Quality Assurance
```
Î›.routing_validation = (
    test_routing_decisions_with_sample_requests()
    â¨ verify_all_servers_in_routing_table_exist()
    â¨ ensure_interactive_feedback_called_after_every_operation()
    â¨ validate_fallback_protocols_work_correctly()
    â¨ check_cross_references_to_other_rules_are_valid()
)
```

### Î›.anti_patterns: Error Prevention
```
Î›.anti_patterns = {
    missing_feedback_call: ğŸ”´ CRITICAL_VIOLATION,
    hardcoded_server_paths: âš ï¸ MAJOR_VIOLATION,
    missing_fallback_handling: âš ï¸ MAJOR_VIOLATION,
    unclear_user_communication: âš¡ VIOLATION,
    incomplete_routing_logic: âš¡ VIOLATION,
    missing_cross_references: âš¡ VIOLATION
}

Î›.integration_compliance = (
    ensure_rule_101_mandatory_protocols_followed()
    â¨ coordinate_with_workflow_specific_rules_202_203()
    â¨ maintain_consistency_across_mcp_system()
    â¨ prevent_conflicts_between_server_operations()
)
```

---
*Î›.mcp_system: comprehensive_MCP_management_with_intelligent_routing_mandatory_feedback_and_scalable_architecture*